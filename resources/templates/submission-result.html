<html>

<head>
    <link rel="stylesheet" type="text/css" href="{{bootstrapPath}}">
    <link rel="stylesheet" type="text/css" href="{{cssPath}}">
</head>

<body>
    <div class="container">
        <div class="row py-2">
            <div class="py-2">
                {{{submission_status this}}}
            </div>
        </div>
        {{#if test_cases}}
            <div class="row my-1">
                {{#if points}}
                    <h3>Points gained: {{points}}</h3>
                {{else}}
                    <h3>Points gained: -</h3>
                {{/if}}
            </div>
            <div class="row my-1">
                {{{progress_bar test_cases}}}
            </div>
        {{/if}}
        {{#if feedback_questions}}
        <div id="feedbacknoti"></div>
        <div id="feedback" class="my-5">
            <h4>Anna palautetta</h4>
            <form>
                {{#each feedback_questions}}
                <div>
                    {{this.question}}
                    <div class="row">
                        <div class="col-md-10">
                        <input name="slider" data-questionID="{{this.id}}" type="range" class="custom-range" min="0"
                            max="5" step="1" value="0" oninput='showValue(this.value, "text-id-{{this.id}}")' />
                        </div>
                        <div class="col-md-2">
                            <span class="font-weight-bold" id="text-id-{{this.id}}">0</span>
                        </div>
                    </div>
                </div>
                {{/each}}
                <div>
                    <button class="btn-primary" onclick="submitFeedback()">Lähetä palaute</button>
                </div>
            </form>
        </div>
        {{/if}}
        <div>
            {{#each test_cases}}
            {{#if this.successful}}
            <div class="row passed my-2">
                {{else}}
                <div class="row failed my-2">
                    {{/if}}
                    <div class="col">
                        <div class="row">
                            {{#if this.successful}}
                            <div class="col-md-1 passed-header">
                                PASS:
                            </div>
                            {{else}}
                            <div class="col-md-1 failed-header">
                                FAIL:
                            </div>
                            {{/if}}
                            <div class="col-md">
                                <span>{{this.name}}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <pre>{{this.message}}</pre>
                            </div>
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
</body>

<script>
    const vscode = acquireVsCodeApi();
    const feedback_url = "{{feedback_answer_url}}";
    const solution_url = "{{solution_url}}";

    function submitFeedback() {
        const feedback = [];
        const questions = document.querySelectorAll("input[type=range]");
        for (question of questions) {
            if (question.value !== "0") {
                feedback.push({ question_id: parseInt(question.dataset.questionid, 10), answer: question.value })
            }
        }
        document.getElementById("feedback").style.display = "none";
        document.getElementById("feedbacknoti").classList = "my-5 alert alert-success";
        if (feedback.length > 0) {
            document.getElementById("feedbacknoti").innerText = "Feedback sent! Thank you.";
        } else {
            document.getElementById("feedbacknoti").innerText = "No feedback given.";
        }
        vscode.postMessage({ feedback: { status: feedback }, url: feedback_url });
    }

    function showValue(value, id) {
        document.getElementById(id).innerHTML=value;
    }

    function viewModelSolution() {
        vscode.postMessage({ showSolutionInBrowser: true, solutionUrl: solution_url });
    }

</script>

</html>
